# Проект 7-го спринта

## Описание кейса и задач

Соцсеть, для которой мы построили Data Lake, развивается — пробный запуск в Австралии оказался удачным. Команда готовится к разработке обновлений. Структуру хранилища предстоит переделать, а данные — дополнить.

Коллеги из другого проекта начали вычислять координаты событий (сообщений, подписок, реакций, регистраций), которые совершили пользователи соцсети. Значения координат появляются в таблице событий. Пока определяется геопозиция только исходящих сообщений, но уже сейчас можно начать разрабатывать новый функционал.
 
Необходимо разработать и внедрить систему рекомендации друзей. Приложение будет предлагать пользователю написать человеку, если пользователь и адресат:
- состоят в одном канале,
- раньше никогда не переписывались,
- находятся не дальше 1 км друг от друга.

Необходимо изучить аудиторию соцсети, чтобы запустить монетизацию. Для этого было решено провести геоаналитику:
- Выяснить, где находится большинство пользователей по количеству сообщений, лайков и подписок из одной точки.
- Посмотреть, в какой точке Австралии регистрируется больше всего новых пользователей.
- Определить, как часто пользователи путешествуют и какие города выбирают.

Благодаря такой аналитике в соцсеть можно будет вставить рекламу: приложение сможет учитывать местонахождение пользователя и предлагать тому подходящие услуги компаний-партнёров. 

## Структура хранилища

Внутри `src` расположены две папки:
- `/src/dags` - содержащая даги;
- `/src/scripts` - содержащая модули и скрипты, которые формируют витрины.

### Витрина в разрезе пользователей - users_mart.py

Расположение: /user/staceykuzm/data/analytics/mart/users/

- user_id - идентификатор пользователя
- act_city - актуальный адрес. Это город, из которого было отправлено последнее сообщение
- home_city - домашний адрес. Это последний город, в котором пользователь был дольше 27 дней

### Витрина в разрезе зон - geo_mart.py

Расположение: /user/staceykuzm/data/analytics/mart/geo/

- month — месяц расчёта;
- week — неделя расчёта;
- zone_id — идентификатор зоны (города);
- week_message — количество сообщений за неделю;
- week_reaction — количество реакций за неделю;
- week_subscription — количество подписок за неделю;
- week_user — количество регистраций за неделю;
- month_message — количество сообщений за месяц;
- month_reaction — количество реакций за месяц;
- month_subscription — количество подписок за месяц;
- month_user — количество регистраций за месяц.

### Витрина для рекомендации друзей - recommendations_mart.py

Расположение: /user/staceykuzm/data/analytics/mart/recommedations/

- user_left — первый пользователь;
- user_right — второй пользователь;
- processed_dttm — дата расчёта витрины;
- zone_id — идентификатор зоны (города);
- local_time — локальное время.

## Порядок выполнения кейса

- Я сформировала модуль initial_load.py с тестовой выборкой (10% от общего объема исходных данных источника - /user/master/data/geo/events). В выборке присутствуют записи за последние 30 дней.
- Координаты городов Австралии находялся в таблице файла geo.csv.
- Я подготовила 3 витрины (jobs): users_mart.py, geo_mart.py, recommendations_mart.py.
- Я подготовила даги:
	-- initial_dag.py, который единоразово загружает текстовую выборку из источника в мою директорию;
	-- sprint_7_dag.py, который обновляет данные в витринах на ежедневной основе.

## Инструменты

Hadoop, PySpark, YARN Resource Manager, Apache Airflow, Jupyter Notebook
